import{p as M,H as I}from"./HorrorButton-D4aTD_XF.js";import{d as S,o as U,c as w,a as l,r as E,b as u,w as $,e as _,f as B,_ as k,g as m,h as N,i as H,t as q,F as C,j as F,n as G,k as L,l as D,m as X,p as V,v as W,u as Y,q as P,s as h,x as J,y as K,z as O,A as Z,B as ee}from"./index-CYDu6qZk.js";import{H as x}from"./HorrorIcon-ZZkR7ucY.js";import{h as y}from"./quizDB-DDEkz681.js";import te from"./bat1-CD6x0hnC.js";import se from"./bat2-DgJqlTlp.js";import oe from"./bat3-Zbi_peGZ.js";import ne from"./bat4-BKP35y0n.js";import ae from"./spider-B6DM6aa7.js";import ie from"./web-DUS4ZeqR.js";const re={class:"modal"},ue={class:"modal__content"},le={class:"modal__title"},ce={class:"modal__controls"},de=S({__name:"HorrorModal",emits:["leave","close"],setup(c){return U(()=>{M("/audio/ghost.mp3")}),(e,t)=>(_(),w("div",re,[l("div",ue,[l("h2",le,[E(e.$slots,"title",{},void 0)]),E(e.$slots,"default",{},void 0),l("div",ce,[u(I,{class:"confirm-btn",onClick:t[0]||(t[0]=o=>e.$emit("leave"))},{default:$(()=>t[2]||(t[2]=[B("Ухожу")])),_:1}),u(I,{class:"cancel-btn",onClick:t[1]||(t[1]=o=>e.$emit("close"))},{default:$(()=>t[3]||(t[3]=[B("Я передумал")])),_:1})])])]))}}),me=k(de,[["__scopeId","data-v-9e61044d"]]);function ve(c){for(let e=c.length-1;e>0;e--){const t=Math.floor(Math.random()*(e+1));[c[e],c[t]]=[c[t],c[e]]}return c}const _e={class:"quiz-question"},pe={class:"quiz-question__text"},fe={class:"quiz-question__answers"},ge=["onClick"],he=S({__name:"HorrorQuizQuestion",props:{question:{},isNextQuestion:{type:Boolean}},emits:["selectAnswer","sumUpTakenTime"],setup(c,{emit:e}){const t=c,o=e,a=m(0),n=m(0),i=m(""),p=N(()=>ve(t.question.answers));function T(d){n.value=Date.now(),M("/audio/drop.mp3",.3),i.value=d,o("selectAnswer",i.value);const r=(n.value-a.value)/1e3;o("sumUpTakenTime",r)}return H(()=>t.isNextQuestion,d=>{d&&(i.value="")}),H(()=>t.question.question,d=>{a.value=Date.now()},{immediate:!0}),(d,r)=>(_(),w("div",_e,[l("p",pe,q(d.question.question),1),l("ul",fe,[(_(!0),w(C,null,F(p.value,s=>(_(),w("li",{class:G(["quiz-question__answer",[{selected:i.value===s},s===d.question.correctAnswer?"success":"fail",{disabled:i.value}]]),key:s,onClick:f=>!i.value&&T(s)},[l("span",null,q(s),1),i.value===s?(_(),L(x,{key:0,class:"quiz-question__mark",size:"24",name:s===d.question.correctAnswer?"pumpkin":"skull-small"},null,8,["name"])):D("v-if",!0)],10,ge))),128))])]))}}),we=k(he,[["__scopeId","data-v-05fbbe67"]]),Te={key:0,class:"horror-timer"},$e={class:"horror-timer__count"},R=20,qe=S({__name:"HorrorTimer",props:{isAnswerSelected:{type:Boolean},isLastQuestion:{type:Boolean}},emits:["resetTimer"],setup(c,{emit:e}){const t=c,o=e,a=m(R),n=m(null),i=m(!1);function p(){n.value=setInterval(()=>{a.value>0?a.value--:(clearInterval(n.value),i.value=!0)},1e3)}function T(){n.value&&clearInterval(n==null?void 0:n.value),setTimeout(()=>{a.value=R,o("resetTimer"),p()},2e3)}H(a,r=>{r===0&&(M("/audio/dracula.mp3"),t.isLastQuestion?o("resetTimer"):T())}),H(()=>t.isAnswerSelected,r=>{r&&!t.isLastQuestion&&T(),n.value&&r&&t.isLastQuestion&&clearInterval(n.value)}),U(()=>{p()}),X(()=>{n.value&&clearInterval(n.value)});const d=N(()=>{const r=Math.floor(a.value/60).toString().padStart(2,"0"),s=(a.value%60).toString().padStart(2,"0");return`${r}:${s}`});return(r,s)=>i.value?D("v-if",!0):(_(),w("div",Te,[l("h2",$e,q(d.value),1)]))}}),Se=k(qe,[["__scopeId","data-v-20ab51e3"]]),ke=S({__name:"HorrorButtonMute",emits:["toggleMute"],setup(c,{emit:e}){const t=e,o=m(!1);function a(){o.value=!o.value,t("toggleMute")}return(n,i)=>(_(),w("button",{class:"mute-button",onClick:a},[V(u(x,{name:"mute",color:"#ff8c00",size:"26"},null,512),[[W,o.value]]),V(u(x,{name:"unmute",color:"#ff8c00",size:"26"},null,512),[[W,!o.value]])]))}}),ze=k(ke,[["__scopeId","data-v-2f09de1f"]]),Ae={class:"quiz-window"},Be={class:"quiz-window__header"},Me={class:"question-counter"},be=S({__name:"HorrorQuizWindow",emits:["muteSound"],setup(c){const{currentUser:e}=Y(),t=P(),o=m(0),a=m(0),n=m(0),i=m(!1),p=N(()=>o.value===y.length-1);async function T(){await z(),await M("/audio/ghost-breath.mp3"),await t.push({name:"verdict"})}async function d(){p.value&&await T(),o.value++,i.value=!1}async function r(v){v===y[o.value].correctAnswer&&a.value++,i.value=!0,p.value&&(await z(),await M("/audio/ghost-breath.mp3"),await t.push({name:"verdict"}))}function s(v){n.value+=v}function f(v,g,b){const A=v/15*100,Q=(300-g)/300*100,j=1/b*100;return A===0?0:Math.round(.5*A+.2*Q+.2*j)}async function z(){var v;try{if(e.value){const g=J(K,"quiz-users",e.value.id),b=await O(g),A=Math.round(n.value),Q=((v=b.data())==null?void 0:v.tries)+1;await Z(g,{score:f(a.value,A,Q),answers:a.value,time:A,tries:Q})}}catch(g){console.error(g)}}return(v,g)=>(_(),w("div",Ae,[l("div",Be,[u(ze,{onToggleMute:g[0]||(g[0]=b=>v.$emit("muteSound"))}),u(Se,{"is-answer-selected":i.value,"is-last-question":p.value,onResetTimer:d},null,8,["is-answer-selected","is-last-question"]),l("div",Me,q(o.value+1)+" / "+q(h(y).length),1)]),u(we,{question:h(y)[o.value],"is-next-question":!i.value,onSelectAnswer:r,onSumUpTakenTime:s},null,8,["question","is-next-question"])]))}}),Qe=k(be,[["__scopeId","data-v-942240a0"]]),ye={class:"main-page"},Ie={class:"main-page__decorations"},He={class:"main-page__header"},Ce={class:"main-page__options"},Le=S({__name:"QuizPage",setup(c){const e=new Audio("/audio/halloween.mp3");e.preload="auto",e.loop=!0;const{currentUser:t}=Y(),o=m(!1),a=m(!1);function n(r){document.querySelectorAll(".main-page__decoration").forEach(s=>{const f=s.getAttribute("data-speed");if(f){const z=(window.innerWidth-r.pageX*Number(f))/100,v=(window.innerHeight-r.pageY*Number(f))/100;s.style.transform=`translateX(${z}px) translateY(${v}px)`}})}function i(){a.value=!a.value}function p(){e.play(),e.volume=.1}function T(){e.volume=e.volume>0?0:.2}function d(){p(),o.value=!0}return U(()=>{window.addEventListener("mousemove",n)}),X(()=>{removeEventListener("mousemove",n)}),ee(()=>{e.pause()}),(r,s)=>{var f;return _(),w(C,null,[l("div",ye,[l("div",Ie,[u(h(te),{"data-speed":"9",class:"main-page__decoration"}),u(h(se),{"data-speed":"7",class:"main-page__decoration"}),u(h(oe),{"data-speed":"-10",class:"main-page__decoration"}),u(h(ne),{"data-speed":"-6",class:"main-page__decoration"}),u(h(ae),{"data-speed":"-4",class:"main-page__decoration"}),u(h(ie),{"data-speed":"3",class:"main-page__decoration"})]),o.value?(_(),L(Qe,{key:0,onMuteSound:T})):(_(),w(C,{key:1},[l("div",He,[l("h2",null,"Сыграем в квиз, "+q((f=h(t))==null?void 0:f.username)+" ?",1)]),l("div",Ce,[u(I,{onClick:d},{default:$(()=>s[1]||(s[1]=[B(" Конечно ")])),_:1}),u(I,{onClick:i},{default:$(()=>s[2]||(s[2]=[B(" Может позже... ")])),_:1})])],64))]),a.value?(_(),L(me,{key:0,onClose:i,onLeave:s[0]||(s[0]=z=>r.$router.push({name:"introduction"}))},{title:$(()=>s[3]||(s[3]=[B(" Уже уходишь?! ")])),default:$(()=>s[4]||(s[4]=[l("p",{class:"modal-message"},"Возвращайся, когда наберешься смелости...",-1)])),_:1})):D("v-if",!0)],64)}}}),je=k(Le,[["__scopeId","data-v-0e05bb42"]]);export{je as default};
